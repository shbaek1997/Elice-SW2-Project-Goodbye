tags:
  - name: Remembrances
    description: '추모 관련 API'
  - name: Comments
    description: '추모글 관련 API'

components:
  schemas:
    Remembrance:
      type: object
      required:
      - userId
      - fullName
      - dateOfBirth
      properties:
        _id:
          type: string
          description: '추모 objectId'
          example: '62d05d9f1eed1cb973a7f36c'
        userId:
          type: string
          description: '유저 objectId'
          example: '62c7d6d0aa14441e00d23232'
        fullName:
          type: string
          description: '회원 이름'
          example: '홍길동'
        dateOfBirth:
          type: string
          description: '회원 태어난 날짜'
          example: '1999-01-01'
        dateOfDeath:
          type: string
          description: '회원 사망 날짜'
          example: '2099-01-01'
        isPublic:
          type: boolean
          description: '추모 공개 여부'
          example: true
        photo:
          type: string
          description: '회원 영정 사진 url'
    RemembranceWithCommentId:
      allOf:
      - $ref: "#/components/schemas/Remembrance"
      - type: object
        properties:
          comments:
            type: array
            items:
              $ref: "#/components/schemas/Comment/properties/_id"
            description: '추모글 id 배열'
    Comment:
      type: object
      required:
      - writer
      - title
      - content
      - password
      properties:
        _id:
          type: string
          description: '추모글 objectId'
          example: '62d0661abd3ff204df02a869'
        writer:
          type: string
          description: '추모글 작성자'
          example: '김철수'
        title:
          type: string
          description: '추모글 제목'
          example: '보고싶어요'
        content:
          type: string
          description: '추모글 내용'
          example: '그립습니다.'
        password:
          type: string
          description: '추모글 비밀번호'
  parameters:
    remembranceIdParam:
      name: remembranceId
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/Remembrance/properties/_id"
    commentIdParam:
      name: commentId
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/Comment/properties/_id"
  requestBodies:
    remembranceUpdate:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              fullName:
                $ref: "#/components/schemas/Remembrance/properties/fullName"
              dateOfBirth:
                $ref: "#/components/schemas/Remembrance/properties/dateOfBirth"
              dateOfDeath:
                $ref: "#/components/schemas/Remembrance/properties/dateOfDeath"
              isPublic:
                $ref: "#/components/schemas/Remembrance/properties/isPublic"
              photo:
                $ref: "#/components/schemas/Remembrance/properties/photo"
    commentReq:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              writer:
                $ref: "#/components/schemas/Comment/properties/writer"
              title:
                $ref: "#/components/schemas/Comment/properties/title"
              content:
                $ref: "#/components/schemas/Comment/properties/content"
              password:
                $ref: "#/components/schemas/Comment/properties/password"
  responses:
    remembranceRes:
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/RemembranceWithCommentId"
    remembranceWithCommentsRes:
      content:
        application/json:
          schema:
            allOf:
            - $ref: "#/components/schemas/Remembrance"
            - type: object
              properties:
                comments:
                  type: array
                  items:
                    $ref: "#/components/schemas/Comment"
                  description: '추모글 배열'
    commentRes:
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Comment"

paths:
  /api/remembrances:
    post:
      tags:
      - Remembrances
      summary: "추모 데이터 생성"
      description: "로그인한 유저의 userId로 데이터 조회 후 해당 유저의 추모 데이터 생성"
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                dateOfDeath:
                  $ref: '#/components/schemas/Remembrance/properties/dateOfDeath'
      responses:
        201:
          description: "추모 데이터 생성"
          $ref: "#/components/responses/remembranceRes"
  /api/remembrances?count={count}:
    get:
      tags:
      - Remembrances
      summary: "최신 추모 데이터 조회"
      description: "최근 업데이트된 추모 데이터를 count(default 8) 개수만큼 조회"
      parameters:
      - name: count
        in: query
        schema:
          type: number
          description: 가져올 데이터의 개수
          example: 8
      responses:
        200:
          description: "여러개의 추모 데이터 조회"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/RemembranceWithCommentId"
  /api/remembrances/{remembranceId}:
    get:
      tags:
      - Remembrances
      summary: "특정 추모 데이터 조회"
      description: "remembranceId로 특정 추모 데이터 조회"
      parameters:
      - $ref: "#/components/parameters/remembranceIdParam"
      responses:
        200:
          description: "하나의 추모 데이터 조회"
          $ref: "#/components/responses/remembranceWithCommentsRes"
    patch:
      tags:
      - Remembrances
      summary: "추모 데이터 수정"
      description: "remembranceId로 추모 데이터 조회 후 수정"
      parameters:
      - $ref: "#/components/parameters/remembranceIdParam"
      requestBody:
        $ref: "#/components/requestBodies/remembranceUpdate"
      responses:
        201:
          description: "추모 데이터 수정"
          $ref: "#/components/responses/remembranceRes"
  /api/remembrances/{remembranceId}/comments/{commentId}:
    get:
      tags:
      - Comments
      summary: "특정 추모글 조회"
      description: "remembranceId와 commentId로 특정 추모의 특정 추모글 조회"
      parameters:
      - $ref: "#/components/parameters/remembranceIdParam"
      - $ref: "#/components/parameters/commentIdParam"
      responses:
        200:
          description: "하나의 추모글 조회"
          $ref: "#/components/responses/commentRes"
    patch:
      tags:
      - Comments
      summary: "추모글 수정"
      description: "remembranceId와 commentId로 추모글 조회 후 수정"
      parameters:
      - $ref: "#/components/parameters/remembranceIdParam"
      - $ref: "#/components/parameters/commentIdParam"
      requestBody:
        $ref: "#/components/requestBodies/commentReq"
      responses:
        200:
          description: "추모글 수정"
          $ref: "#/components/responses/commentRes"
    delete:
      tags:
      - Comments
      summary: "추모글 삭제"
      description: "remembranceId와 commentId로 추모글 조회 후 삭제"
      parameters:
      - $ref: "#/components/parameters/remembranceIdParam"
      - $ref: "#/components/parameters/commentIdParam"
      responses:
        201:
          description: "추모글 삭제"
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: string
                    example: 'success'
  /api/remembrances/{remembranceId}/comments:
    post:
      tags:
      - Comments
      summary: "추모글 생성"
      description: "remembrancId로 추모 데이터 조회 후 추모글 추가"
      parameters:
      - $ref: "#/components/parameters/remembranceIdParam"
      requestBody:
        $ref: "#/components/requestBodies/commentReq"
      responses:
        201:
          description: "추모글 생성"
          $ref: "#/components/responses/commentRes"
